function d3_pulse(){function t(r){a=r,t.init()}var a,r=-1,e,n=[],i=!0;return t.init=function(){a.each(function(e,n){var s=d3.select(this);s.selectAll("*").remove();var l=3,c=2,o=56,p=235,d=1,u=147,y=10,h=p-o,x=u-d,f=h*l,g=x*l,m=200,v=180,b=a.append("svg").attr("id","timemap").attr("viewBox","0 0 "+f+" "+g).attr("preserveAspectRatio","xMidYMid meet"),M=d3.select("#d3_circular").append("svg").attr("id","timeline").attr("viewBox","0 0 "+v+" "+m).attr("preserveAspectRatio","xMidYMid meet").append("g"),w=0,A=24,k=20,I=v/2-y-5,P=5,_=60,q=30,F=5,L=15,U=function(t,a,r){var e=2*Math.PI/24,n=k+r(a)*(I-k);return[n*Math.cos(t*e-Math.PI/2),n*Math.sin(t*e-Math.PI/2)]},R=function(t,a,r){var e=2*Math.PI/24,n=F+r(a)*(L-F);return[n*Math.cos(t*e-Math.PI/2),n*Math.sin(t*e-Math.PI/2)]},j=M.append("g").attr("class","grid").attr("transform","translate("+v/2+","+m/2+")"),B=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];j.selectAll("line").data(B).enter().append("line").attr("x1",function(t){var a=U(t,1,function(t){return t});return a[0]}).attr("x2",function(t){var a=U(t,0,function(t){return t});return a[0]}).attr("y1",function(t){var a=U(t,1,function(t){return t});return a[1]}).attr("y2",function(t){var a=U(t,0,function(t){return t});return a[1]}).style("stroke",function(t,a){return"rgba(0,0,0,"+(.3/24*a+.1)+")"});var Y=d3.svg.arc().innerRadius(k).outerRadius(I).startAngle(function(t){return Math.PI/12*t}).endAngle(function(t){return Math.PI/12*(t+1)});for(j.selectAll("path.bg-pattern").data(B).enter().append("path").attr("class",function(t,a){var r="bg-"+a+" bg-pattern";return r+=a%2===!0?" odd":" even"}).attr("d",Y),n=0;P>n;n++)j.append("circle").attr("cx",0).attr("cy",0).attr("r",(I-k)/P*n+k);var Z=M.append("defs"),E=Z.append("mask").attr("id","hole");E.append("rect").attr("x",-v/2).attr("y",-m/2).attr("width",v).attr("height",m).style("fill","white"),E.append("circle").attr("cx",0).attr("cy",0).attr("r",k),j.append("text").attr("class","timetext").attr("x",0).attr("y",7).attr("text-anchor","middle").text(24),j.append("text").attr("class","octext").attr("x",0).attr("y",-(I+5)).attr("text-anchor","middle").text("00:00"),j.append("text").attr("class","octext").attr("x",0).attr("y",I+13).attr("text-anchor","middle").text("12:00"),j.append("text").attr("class","octext").attr("x",I+5).attr("y",3).attr("text-anchor","start").text("06:00"),j.append("text").attr("class","octext").attr("x",-(I+5)).attr("y",3).attr("text-anchor","end").text("18:00");var N={},V={},X={},z={cix:null,instagram:null,twitter:null},C={cix:[],instagram:[],twitter:[]},D={cix:"rgba(152,78,163,1)",instagram:"rgba(77,175,74,1)",twitter:"rgba(55,126,184,1)"},G={cix:"rgba(152,78,163,0.2)",instagram:"rgba(77,175,74,0.2)",twitter:"rgba(55,126,184,0.2)"};for(var H in C){for(n=0;24>n;n++)C[H].push(0);N[H]=M.append("g").attr("transform","translate("+v/2+","+m/2+")"),V[H]=M.append("g").attr("transform","translate("+v/2+","+m/2+")"),X[H]=d3.scale.linear().range([0,1]),z[H]=d3.select("#legend_"+H+" div").append("svg").attr("height",q),"cix"!==H?z[H].attr("width",_):z[H].attr("width",_/2)}M.append("image").attr("class","playbtn").style("opacity",0).attr("x",v/2-28.5).attr("y",m/2-28.5).attr("width",59).attr("height",59).attr("xlink:href","images/play@2x.png"),M.append("circle").attr("id","timebutton").attr("cx",0).attr("cy",0).attr("r",v/2).on("click",function(){var a=d3.mouse(this),e=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2));if(e>20){var n=Math.floor(Math.atan(a[1]/a[0])/(Math.PI/2)*6);0>n&&(n+=7),n+=a[0]>0&&a[1]>0?7:a[0]>0&&a[1]<0?0:a[0]<0&&a[1]<0?19:12,i||r!==n?(i=!1,r=n,requestAnimationFrame(t.iterate),t.stateUpdate()):(i=!0,requestAnimationFrame(t.iterate),t.stateUpdate())}else i||(i=!0,requestAnimationFrame(t.iterate),t.stateUpdate())}).attr("transform","translate("+v/2+","+m/2+")"),d3.json("https://vislab.lupus.uberspace.de/nodejs/tsb/static/info.json",function(a,r){if(a)return console.error(a);for(var e in C){var n=-Number.MAX_VALUE,i;switch(e){case"cix":var s=[66,48,40,32,29,27,23,19,17,16,14,14,14,15,18,20,23,28,32,37,40,45,46,49,53,54,57,60,65,69,67,71,76,74,71,77,75,78,88,74,78,84,83,87,81,74,74,72,66];i=[];for(var l=0;l<s.length;l++)i.push({x:l/2,y:s[l]});break;case"instagram":i=t.reorder("instagram",r);break;case"twitter":i=t.reorder("twitter",r)}for(C[e]=i,l=0;l<i.length;l++)i[l].y>n&&(n=i[l].y);X[e].domain([0,n]),N[e].selectAll("circle").data(C[e]).enter().append("circle").attr("cx",function(t,a){var r=U(t.x,t.y,X[e]);return r[0]}).attr("cy",function(t,a){var r=U(t.x,t.y,X[e]);return r[1]}).style("fill",D[e]).attr("r",1);var c=d3.svg.line().x(function(t,a){var r=U(t.x,t.y,X[e]);return r[0]}).y(function(t,a){var r=U(t.x,t.y,X[e]);return r[1]}),o=d3.svg.line().x(function(t,a){var r=R(t.x,t.y,X[e]);return r[0]}).y(function(t,a){var r=R(t.x,t.y,X[e]);return r[1]});if(V[e].append("path").attr("d",function(){return c(C[e])+" Z"}).style("stroke",D[e]).style("fill",G[e]).attr("mask","url(#hole)").attr("class",e),z[e].append("path").attr("d",function(){return o(C[e])+" Z"}).style("stroke",D[e]).style("fill",G[e]).attr("transform","translate("+q/2+" "+q/2+")"),z[e].append("circle").attr("cx",0).attr("cy",0).attr("r",F-2).style("stroke",D[e]).style("fill","#fff").attr("transform","translate("+q/2+" "+q/2+")"),"cix"!==e)for(z[e].append("line").attr("x1",_/2).attr("x2",_/2).attr("y1",0).attr("y2",q).attr("stroke","rgba(0,0,0,0.2)"),l=0;6>l;l++)z[e].append("circle").attr("cx",_-q+10+Math.random()*(_-q-12)).attr("cy",Math.random()*(q-4)+2).attr("r",2).style("fill",D[e]).style("stroke","none")}});var J,K,O,Q,S,T,W,tt={twitter:null,instagram:null};b.append("image").attr("xlink:href","images/pulse_background_lg.png").attr("x",0).attr("y",0).attr("width",542).attr("height",441);for(var at=0;24>at;at++)b.append("image").attr("xlink:href","http://prjcts.sebastianmeier.eu/tsb/images/animation_"+at+".png").attr("x",0).attr("class","animationLayer").attr("id","animationLayer_"+at).attr("y",0).attr("width",542).attr("height",441);requestAnimationFrame(t.iterate)})},t.stateUpdate=function(){i?(d3.select(".timetext").style("opacity",1),d3.select(".playbtn").style("opacity",0)):(d3.select(".timetext").style("opacity",.3),d3.select(".playbtn").style("opacity",1))},t.iterate=function(){24===r&&(r=0),d3.selectAll(".animationLayer").style("display","none"),d3.select("#animationLayer_"+r).style("display","block"),d3.selectAll("path.bg-pattern.odd").style("opacity",.01),d3.selectAll("path.bg-pattern.even").style("opacity",.03);var a=r-2;0>a&&(a+=24);var e=r-3;0>e&&(e+=24);var n=r-4;0>n&&(n+=24);var s=r-1;0>s&&(s+=24),d3.select("path.bg-"+s).style("opacity",.3),d3.select("path.bg-"+a).style("opacity",.2),d3.select("path.bg-"+e).style("opacity",.1),d3.select("path.bg-"+n).style("opacity",.05),d3.select(".timetext").text(r),i&&(r++,r>23&&(r=0),requestAnimationFrame(debouncer(t.iterate,200)))},t.reorder=function(t,a){var r=[];for(var e in a.histogram[t])r.push({x:e,y:parseInt(a.histogram[t][e])});return r},t}
